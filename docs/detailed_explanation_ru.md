<!-- omit in toc -->
# Подробное описание работы приложения OpenGL

<!-- omit in toc -->
## Содержание

- [Общая структура приложения](#общая-структура-приложения)
  - [Ключевые компоненты](#ключевые-компоненты)
- [Математические основы](#математические-основы)
  - [Система координат](#система-координат)
  - [Матрицы трансформации](#матрицы-трансформации)
  - [Алгоритм построения тора](#алгоритм-построения-тора)
- [Работа с материалами](#работа-с-материалами)
  - [Прозрачный куб](#прозрачный-куб)
  - [Золотая сфера](#золотая-сфера)
- [Освещение](#освещение)
  - [Модель освещения](#модель-освещения)
  - [Параметры источника света](#параметры-источника-света)
- [Текстурирование](#текстурирование)
  - [Загрузка текстур](#загрузка-текстур)
  - [UV-развертка тора](#uv-развертка-тора)
- [Камера и проекции](#камера-и-проекции)
  - [Перспективная проекция](#перспективная-проекция)
  - [Управление камерой](#управление-камерой)
- [Интерфейс пользователя](#интерфейс-пользователя)
  - [Рендеринг текста](#рендеринг-текста)
  - [Отображение состояния](#отображение-состояния)
- [Оптимизация](#оптимизация)
  - [Управление глубиной](#управление-глубиной)

## Общая структура приложения

Приложение построено на основе библиотеки OpenGL с использованием GLUT для создания окна и обработки событий. Основная логика инкапсулирована в классе `Scene`.

### Ключевые компоненты

- Инициализация OpenGL и создание окна
- Управление состоянием сцены
- Отрисовка трёх объектов с разными материалами
- Управление источником света
- Обработка пользовательского ввода

## Математические основы

### Система координат

В приложении используется правосторонняя система координат OpenGL:

- X - направлен вправо
- Y - направлен вверх
- Z - направлен от наблюдателя

### Матрицы трансформации

```
| cos θ  -sin θ   0   0 |
| sin θ   cos θ   0   0 |
|   0      0      1   0 |
|   0      0      0   1 |
```

Для поворота камеры используются матрицы поворота вокруг осей X и Y.

### Алгоритм построения тора

Тор строится как параметрическая поверхность с уравнениями:

```
x = (R + r·cos(φ))·cos(θ)
y = (R + r·cos(φ))·sin(θ)
z = r·sin(φ)
```

*где*:

- `R` - радиус тора
- `r` - радиус трубки
- `θ ∈ [0, 2π]` - угол в плоскости `XY`
- `φ ∈ [0, 2π]` - угол в сечении тора

## Работа с материалами

### Прозрачный куб

```python
gl.glMaterialfv(gl.GL_FRONT, gl.GL_AMBIENT, [0.2, 0.2, 0.2, self.alpha])
gl.glMaterialfv(gl.GL_FRONT, gl.GL_DIFFUSE, [0.8, 0.8, 0.8, self.alpha])
gl.glMaterialfv(gl.GL_FRONT, gl.GL_SPECULAR, [1.0, 1.0, 1.0, self.alpha])
```

Альфа-канал меняется от 0.5 до 0.9 для создания эффекта пульсирующей прозрачности.

### Золотая сфера

Параметры материала подобраны для имитации золота:

```python
# Фоновое отражение
gold_ambient = [0.24725, 0.1995, 0.0745, 1.0]
# Диффузное отражение
gold_diffuse = [0.75164, 0.60648, 0.22648, 1.0]
# Бликовое отражение
gold_specular = [0.628281, 0.555802, 0.366065, 1.0]
```

## Освещение

### Модель освещения

Используется модель Фонга (**Phong lighting model**):

`I = ka·ia + kd·id·(N·L) + ks·is·(R·V)^n`

*где*:

- `ka`, `kd`, `ks` - коэффициенты материала
- `ia`, `id`, `is` - интенсивности составляющих света
- `N` - нормаль к поверхности
- `L` - направление на источник света
- `R` - отраженный луч
- `V` - направление на наблюдателя
- `n` - степень зеркального отражения

### Параметры источника света

- Позиция: управляется клавишами WASD и стрелками вверх/вниз
- Интенсивность: управляется клавишами Q/E
- Цвет: управляется клавишами RGB/rgb

## Текстурирование

### Загрузка текстур

Текстуры загружаются из файла или генерируются процедурно (шахматная доска).

### UV-развертка тора

- `u = θ / (2π)` - нормализованный угол в плоскости `XY`
- `v = φ / (2π)` - нормализованный угол сечения

## Камера и проекции

### Перспективная проекция

```python
glu.gluPerspective(45,           # угол обзора
                   800.0/600.0,  # соотношение сторон
                   0.1,          # ближняя плоскость отсечения
                   100.0)        # дальняя плоскость отсечения
```

### Управление камерой

- **Вращение**: левая кнопка мыши
- **Панорамирование**: средняя кнопка мыши
- **Зум**: колесико мыши

## Интерфейс пользователя

### Рендеринг текста

Для отображения текста используется ортографическая проекция и битмап-шрифты GLUT:

```python
gl.glOrtho(0, 800,  # X координаты
           0, 600,  # Y координаты
           -1, 1)   # Z координаты
```

### Отображение состояния

- Позиция источника света
- Интенсивность освещения
- Цвет освещения
- Дистанция камеры
- Прозрачность куба

## Оптимизация

### Управление глубиной

Прозрачные объекты рисуются последними для корректного смешивания:

```python
gl.glDepthMask(gl.GL_FALSE)  # Отключаем запись в буфер глубины
# Рисуем прозрачные объекты
gl.glDepthMask(gl.GL_TRUE)   # Включаем запись в буфер глубины
```
